{% extends "base.html" %}

{% block title %}{{ product['name'] }} - LITUS{% endblock %}

{% block content %}
<!-- Product Detail Section -->
<section class="product-detail-section section-padding">
    <div class="container">
        <div class="product-detail-grid">
            <!-- Product Image -->
            <div class="product-detail-image" data-aos="fade-right">
                {% if product['image'] %}
                    <img src="{{ url_for('static', filename='uploads/' + product['image']) }}" alt="{{ product['name'] }}">
                {% else %}
                    <div class="product-placeholder-large">
                        <i class="fas fa-image"></i>
                    </div>
                {% endif %}
            </div>
            
            <!-- Product Info -->
            <div class="product-detail-info" data-aos="fade-left">
                <h1 class="product-detail-name">{{ product['name'] }}</h1>
                <p class="product-detail-price">{{ "%.2f"|format(product['price']) }} ₺</p>
                
                {% if product['description'] %}
                <div class="product-detail-description">
                    <h3>Açıklama</h3>
                    <p>{{ product['description'] }}</p>
                </div>
                {% endif %}
                
                <div class="product-detail-actions">
                    {% if current_user %}
                        <button class="btn-luxury" id="addToCartBtn" data-product-id="{{ product['id'] }}">
                            <i class="fas fa-shopping-bag"></i> Sepete Ekle
                        </button>
                        <button class="btn-luxury-outline" id="toggleFavoriteBtn" data-product-id="{{ product['id'] }}">
                            <i class="fas fa-heart{% if not is_favorite %}-o{% endif %}"></i> 
                            <span id="favoriteText">{% if is_favorite %}Favorilerden Çıkar{% else %}Favorilere Ekle{% endif %}</span>
                        </button>
                    {% else %}
                        <a href="{{ url_for('login') }}" class="btn-luxury">
                            <i class="fas fa-shopping-bag"></i> Sepete Ekle
                        </a>
                        <a href="{{ url_for('login') }}" class="btn-luxury-outline">
                            <i class="fas fa-heart"></i> Favorilere Ekle
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Comments Section -->
        <div class="comments-section" data-aos="fade-up">
            <h2 class="section-title">Yorumlar</h2>
            
            <!-- Add Comment Form -->
            {% if current_user %}
            <div class="comment-form-card">
                <h3>Yorum Yap</h3>
                <form method="POST" action="{{ url_for('add_comment', product_id=product['id']) }}">
                    <div class="form-group">
                        <textarea name="comment" class="form-textarea" rows="4" placeholder="Yorumunuz" required></textarea>
                    </div>
                    <button type="submit" class="btn-luxury">Yorum Yap</button>
                </form>
            </div>
            {% else %}
            <div class="comment-form-card">
                <p>Yorum yapmak için <a href="{{ url_for('login') }}">giriş yapın</a>.</p>
            </div>
            {% endif %}
            
            <!-- Comments List -->
            <div class="comments-list">
                {% if comments %}
                    {% for comment in comments %}
                    <div class="comment-item" data-aos="fade-up" data-aos-delay="{{ loop.index0 * 50 }}">
                        <div class="comment-header">
                            <strong class="comment-username">{{ comment['username'] }}</strong>
                            <span class="comment-date">{{ comment['created_at'] }}</span>
                        </div>
                        <p class="comment-text">{{ comment['comment'] }}</p>
                    </div>
                    {% endfor %}
                {% else %}
                    <p class="no-comments">Henüz yorum yapılmamış. İlk yorumu siz yapın!</p>
                {% endif %}
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    // Sepete ekle
    const addToCartBtn = document.getElementById('addToCartBtn');
    if (addToCartBtn) {
        addToCartBtn.addEventListener('click', function() {
            const productId = this.getAttribute('data-product-id');
            addToCart(productId, 1);
        });
    }
    
    // Favori toggle
    const toggleFavoriteBtn = document.getElementById('toggleFavoriteBtn');
    if (toggleFavoriteBtn) {
        toggleFavoriteBtn.addEventListener('click', function() {
            const productId = this.getAttribute('data-product-id');
            toggleFavorite(productId);
        });
    }
</script>
{% endblock %}
